@model Bakery.Models.ViewModels.HomeVM
@{
	ViewBag.Title = "Home Page";
}

@section Styles {
	<link href="~/Content/styles/home.css" rel="stylesheet" type="text/css" />
}

<div class="m-carousel">
	<div class="slider">
		@foreach (var x in Model.khuyenmais)
		{
			<div class="slide">
				<a href="@Url.Action("Details", "KhuyenMais", new { id=x.MaKM })">
					<img src="@x.pr_img" alt="" class="slide-bg">
				</a>
				<div class="content">
					<img src="" alt="" class="content-bg">
					<div class="text">
						<h2 class="font-lavish">
							@x.TenKM
						</h2>
						<p class="font-nunito">
							@x.MoTa
						</p>
					</div>
					<div class="pager">
					</div>
				</div>
			</div>
		}
	</div>
		
</div>

<div class="m-container font-lexend">
	<div class="tag ">Bạn nên thử</div>
	<div class="bestseller-header">
		<div class="left">
			<div class="m-header font-lavish">
				Sản phẩm nổi bật
			</div>
		</div>
		<div class="right">
			<div class="prev btn disabled" onclick="moveProductSlide(0)"><</div>
			<div class="next btn" onclick="moveProductSlide(1)">></div>
		</div>
	</div>
	<div class="product-slide">
		<div class="slider">
			<div class="slide">
				@for (int i = 0; i < Math.Min(4, Model.sanphams.Count()); i++)
				{
					<a href="@Url.Action("details", "SanPhams", new {id = Model.sanphams[i].MaSP})">
						<div class="product">
							<img src="@(Model.sanphams[i].img)" alt="" class="p_img">
							<div class="name">@(Model.sanphams[i].TenSP)</div>
							<div class="m-row">
								@Model.sanphams[i].Sao / 5
								<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" class="icon ms-1 me-2">
									<path fill="#FFE145" d="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 113.2 474.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 128.3 68.5c10.8 5.7 23.9 4.9 33.8-2.3s14.9-19.3 12.9-31.3L438.5 329 542.7 225.9c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.2 150.3 316.9 18z"></path>
								</svg>
								<i>(@Model.sanphams[i].SoLuotDanhGia đánh giá)</i>
							</div>
							<div class="price">
								@if (Model.sanphams[i].TiLeKM.HasValue)
								{
									<del>@string.Format("{0:N0}", Model.sanphams[i].GiaSP)</del>
									<text>@string.Format("{0:N0}", Model.sanphams[i].GiaSP * (1 - Model.sanphams[i].TiLeKM))</text>
								}
								else
								{
									<text>@string.Format("{0:N0}", Model.sanphams[i].GiaSP)</text>
								}
								đ
							</div>
						</div>
					</a>
				}
			</div>
			<div class="slide">
				@for (int i = 4; i < Model.sanphams.Count(); i++)
				{
					<a href="@Url.Action("details", "SanPhams", new {id = Model.sanphams[i].MaSP})">
						<div class="product">
							<img src="@(Model.sanphams[i].img)" alt="">
							<div class="name">@(Model.sanphams[i].TenSP)</div>
							<div class="m-row">
								@Model.sanphams[i].Sao / 5
								<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512" class="icon ms-1 me-2">
									<path fill="#FFE145" d="M316.9 18C311.6 7 300.4 0 288.1 0s-23.4 7-28.8 18L195 150.3 51.4 171.5c-12 1.8-22 10.2-25.7 21.7s-.7 24.2 7.9 32.7L137.8 329 113.2 474.7c-2 12 3 24.2 12.9 31.3s23 8 33.8 2.3l128.3-68.5 128.3 68.5c10.8 5.7 23.9 4.9 33.8-2.3s14.9-19.3 12.9-31.3L438.5 329 542.7 225.9c8.6-8.5 11.7-21.2 7.9-32.7s-13.7-19.9-25.7-21.7L381.2 150.3 316.9 18z"></path>
								</svg>
								<i>(@Model.sanphams[i].SoLuotDanhGia đánh giá)</i>
							</div>
							<div class="price">
								@if (Model.sanphams[i].TiLeKM.HasValue)
								{
									<del>@string.Format("{0:N0}", Model.sanphams[i].GiaSP)</del>
									<text>@string.Format("{0:N0}", Model.sanphams[i].GiaSP * (1 - Model.sanphams[i].TiLeKM))</text>
								}
								else
								{
									<text>@string.Format("{0:N0}", Model.sanphams[i].GiaSP)</text>
								}
								đ
							</div>
						</div>
					</a>
				}
			</div>
		</div>
	</div>

	<div class="tag ">Giới thiệu</div>
	<div class="m-header font-lavish">
		Về chúng tôi
	</div>
	<p class="about ">
		Từ năm 1996, <span class="yellow">yellowkitchen</span> là một trong những tiệm bánh được yêu thích nhất của Việt Nam và đặt ra tiêu chuẩn cho các
		món bánh ngọt và bánh mặn đã được thử và đúng. Đi cùng chúng tôi để hiểu về hành trình từ viên ngọc quý còn thô đến
		thành công đầy ngọt ngào.
	</p>
	<img src="~/Content/imgs/home-about.png" alt="" class="about-img">
</div>

@section scripts {
	<script>
    const slides = $('.m-carousel .slider .slide')
    const nSlides = slides.length - 1;
    const slider = $('.m-carousel .slider');
    let currentSlide = 0;
    const SLIDE_DELAY_TIME = 3000;
    let slideInterval;
    let mouseOverCarousel = false;

    $(document).ready(()=>{
        addPager();
        startSlideInterval();

		$('.m-carousel').on('mouseenter', () => {
            clearInterval(slideInterval);
            mouseOverCarousel = true;
        })
		$('.m-carousel').on('mouseleave', () => {
			mouseOverCarousel = false;
			startSlideInterval();
        })
    })

    const startSlideInterval = ()=>{
        clearInterval(slideInterval);
        if(!mouseOverCarousel) slideInterval = setInterval(() => { nextSlide(1) }, SLIDE_DELAY_TIME);
    }

    const addPager = ()=>{
        let pagers = $('.m-carousel .slider .slide .pager');

        let htmlPages = '';
        for(let i =0; i<=nSlides; i++) htmlPages += `<div class="page" onclick='slideTo(${i})'></div>`
        const html = `
                <div class="prev" onclick='nextSlide(-1)'>
                <img src="@Url.Content("~/Content/imgs/prev-icon.png")" alt="">
            </div>
            ${htmlPages}
            <div class="next" onclick='nextSlide(1)'>
                <img src="@Url.Content("~/Content/imgs/next-icon.png")" alt="">
            </div>
        `
        for(let i =0; i< pagers.length; i++){
            $(pagers[i]).html(html);
            let selectedPage = $(pagers[i]).find('.page')[i];
            $(selectedPage).addClass('selected');
        }
    }

    const slideTo = (i) => {
        if(i > nSlides) i = 0;
        if(i < 0) i = nSlides;
        currentSlide = i;
        startSlideInterval();
        $(slider).css('transform', `translateX(calc(100% * -${i}))`)
    }
    const nextSlide = (i) =>{
        slideTo(currentSlide + i);
	}

	let currentProductSlide = 0;
	const moveProductSlide = (i) => {
		if (currentProductSlide === i) return;
		if (i != 0) i = 1;
		$('.product-slide .slider').css('transform', `translateX(calc(100% * -${i}))`)
		currentProductSlide = i;
		$('.bestseller-header .prev').toggleClass('disabled')
		$('.bestseller-header .next').toggleClass('disabled')
	}

	</script>
}
